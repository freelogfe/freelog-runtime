<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/freelog-runtime/freelog.ico">
    <meta name="description" content="freelog 开发者文档">
    
    <link rel="preload" href="/freelog-runtime/assets/css/0.styles.1b5b480a.css" as="style"><link rel="preload" href="/freelog-runtime/assets/js/app.97b599e4.js" as="script"><link rel="preload" href="/freelog-runtime/assets/js/2.b24e057d.js" as="script"><link rel="preload" href="/freelog-runtime/assets/js/7.03a5609f.js" as="script"><link rel="prefetch" href="/freelog-runtime/assets/js/3.8e1af9e1.js"><link rel="prefetch" href="/freelog-runtime/assets/js/4.2dcc8728.js"><link rel="prefetch" href="/freelog-runtime/assets/js/5.b450b3e6.js"><link rel="prefetch" href="/freelog-runtime/assets/js/6.f0aa50fb.js"><link rel="prefetch" href="/freelog-runtime/assets/js/8.38a0aee0.js"><link rel="prefetch" href="/freelog-runtime/assets/js/9.40425a6c.js">
    <link rel="stylesheet" href="/freelog-runtime/assets/css/0.styles.1b5b480a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/freelog-runtime/" aria-current="page" class="home-link router-link-exact-active router-link-active"><img src="/freelog-runtime/logo.svg" alt="docs" class="logo"> <span class="site-name can-hide">docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/freelog-runtime/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><a href="/freelog-runtime/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/freelog-runtime/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/freelog-runtime/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><a href="/freelog-runtime/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/freelog-runtime/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/freelog-runtime/#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/freelog-runtime/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#通俗解释" class="sidebar-link">通俗解释</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#运行原理" class="sidebar-link">运行原理</a></li></ul></li><li><a href="/freelog-runtime/#框架准备" class="sidebar-link">框架准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/freelog-runtime/#支持框架" class="sidebar-link">支持框架</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#webpack-通用配置" class="sidebar-link">webpack 通用配置</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#vue2-配置示例" class="sidebar-link">Vue2 配置示例</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#vue3-配置示例" class="sidebar-link">Vue3 配置示例</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#react-配置示例" class="sidebar-link">React 配置示例</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#jquery-配置" class="sidebar-link">jquery 配置</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#路由支持" class="sidebar-link">路由支持</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#配置总结" class="sidebar-link">配置总结</a></li></ul></li><li><a href="/freelog-runtime/#开发" class="sidebar-link">开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/freelog-runtime/#创建一个节点和主题" class="sidebar-link">创建一个节点和主题</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#连接节点与插件" class="sidebar-link">连接节点与插件</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#加载子依赖插件" class="sidebar-link">加载子依赖插件</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#加载孙插件-完善中" class="sidebar-link">加载孙插件（完善中）</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#加载展品插件" class="sidebar-link">加载展品插件</a></li></ul></li><li><a href="/freelog-runtime/#获取插件自身配置数据" class="sidebar-link">获取插件自身配置数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/freelog-runtime/#获取展品" class="sidebar-link">获取展品</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#获取展品详情" class="sidebar-link">获取展品详情</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#获取展品资源" class="sidebar-link">获取展品资源</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#获取展品子依赖" class="sidebar-link">获取展品子依赖</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#授权处理" class="sidebar-link">授权处理</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#静态文件处理" class="sidebar-link">静态文件处理</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#重载插件" class="sidebar-link">重载插件</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#插件通信" class="sidebar-link">插件通信</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#获取当前登录用户信息" class="sidebar-link">获取当前登录用户信息</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#监听用户登录事件" class="sidebar-link">监听用户登录事件</a></li><li class="sidebar-sub-header"><a href="/freelog-runtime/#用户数据" class="sidebar-link">用户数据</a></li></ul></li><li><a href="/freelog-runtime/#打包上传" class="sidebar-link">打包上传</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/freelog-runtime/#移动端适配" class="sidebar-link">移动端适配</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>在 Freelog 平台，插件是指资源类型为插件的功能性资源，一般作为主题的依赖在节点发挥作用，决定节点中内容型展品的访问、展示和交互方式。</p> <p>插件可以是一个播放器、一个图床、一个目录菜单或者一个小说阅读器。</p> <h3 id="通俗解释"><a href="#通俗解释" class="header-anchor">#</a> 通俗解释</h3> <p><strong>插件是一个运行在我司平台运行时的可管控的一个完整应用或组件</strong></p> <p><strong>后面出现的运行时皆指平台运行时</strong></p> <h3 id="运行原理"><a href="#运行原理" class="header-anchor">#</a> 运行原理</h3> <p><strong>插件打包后的文件是放在我司平台的，运行时通过解析 index.html 和修改 webpack_public_path 获取 js 和 css 等资源文件</strong></p> <p><strong>同时从 js 中获取导出的插件生命周期来启动、加载、卸载插件</strong></p> <h2 id="框架准备"><a href="#框架准备" class="header-anchor">#</a> 框架准备</h2> <h3 id="支持框架"><a href="#支持框架" class="header-anchor">#</a> 支持框架</h3> <p><strong>vue, react, angular 仅支持以 webpack 打包</strong> <strong>jquery</strong></p> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <p><strong>平台运行时所需要入口文件 export 的三个生命周期，用来供平台启动准备、加载、卸载插件</strong></p> <div class="language- extra-class"><pre class="language-text"><code>bootstrap--&gt;mount--&gt;unmount

bootstrap: 加载未运行，目前不建议进行

mount: 放置插件启动代码

unmount: 将所有实例置位null，回收内存
</code></pre></div><h3 id="webpack-通用配置"><a href="#webpack-通用配置" class="header-anchor">#</a> webpack 通用配置</h3> <p><strong>入口配置</strong></p> <p>由于插件所有文件都交给平台管理，平台运行时替代了类似 nginx 的功能，插件文件访问插件文件都通过运行时，例如 index.html 中的 js，css，或 js 中的图片</p> <p>运行时会替换 <strong>_ <strong>webpack_public_path</strong> _</strong> 让打包后的文件访问能指向正确的插件文件访问路径</p> <div class="language- extra-class"><pre class="language-text"><code>// 建一个包含一下内容的public-path.js文件，在应用入口文件开头引入

if (window.__POWERED_BY_FREELOG__) {
  // eslint-disable-next-line no-undef
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_FREELOG__;
}
</code></pre></div><p><strong>打包配置文件配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 开发模式需配置headers</span>

devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    disableHostCheck<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    port<span class="token punctuation">,</span>
    overlay<span class="token operator">:</span> <span class="token punctuation">{</span>
        warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        errors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 将以下属性合并到webpack配置当中 其中name是package.json中的name，自行引入</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把子应用打包成 umd 库格式</span>
    library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    jsonpFunction<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="vue2-配置示例"><a href="#vue2-配置示例" class="header-anchor">#</a> Vue2 配置示例</h3> <p><strong>入口配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token string">&quot;./public-path&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ElementUI <span class="token keyword">from</span> <span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;element-ui/lib/theme-chalk/index.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementUI<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    base<span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;history&quot;</span><span class="token punctuation">,</span>
    routes<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    router<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_FREELOG__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">.</span>onGlobalStateChange <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[onGlobalStateChange - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>setGlobalState <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      ignore<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      user<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[vue] vue app bootstraped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[vue] props from main framework&quot;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>webpack 配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;./package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">7101</span><span class="token punctuation">;</span> <span class="token comment">// dev port</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * You will need to set publicPath if you plan to deploy your site under a sub path,
   * for example GitHub Pages. If you plan to deploy your site to https://foo.github.io/bar/,
   * then publicPath should be set to &quot;/bar/&quot;.
   * In most cases please use '/' !!!
   * Detail: https://cli.vuejs.org/config/#publicpath
   */</span>
  outputDir<span class="token operator">:</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span>
  assetsDir<span class="token operator">:</span> <span class="token string">&quot;static&quot;</span><span class="token punctuation">,</span>
  filenameHashing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// tweak internal webpack configuration.</span>
  <span class="token comment">// see https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// host: '0.0.0.0',</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    disableHostCheck<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    port<span class="token punctuation">,</span>
    overlay<span class="token operator">:</span> <span class="token punctuation">{</span>
      warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      errors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 自定义webpack配置</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
      alias<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;@&quot;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 把子应用打包成 umd 库格式</span>
      library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>
      jsonpFunction<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vue3-配置示例"><a href="#vue3-配置示例" class="header-anchor">#</a> Vue3 配置示例</h3> <p><strong>入口配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token string">&quot;./public-path&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 入口配置</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    history<span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    routes<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  instance <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_FREELOG__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;%c &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;color: green;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vue3.0 app bootstraped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$onGlobalStateChange <span class="token operator">=</span>
    props<span class="token punctuation">.</span>onGlobalStateChange<span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$setGlobalState <span class="token operator">=</span> props<span class="token punctuation">.</span>setGlobalState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>_container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 插件通信功能暂未测试</span>
<span class="token keyword">function</span> <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">.</span>onGlobalStateChange <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[onGlobalStateChange - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>setGlobalState <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      ignore<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      user<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>webpack 配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;./package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">7105</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  outputDir<span class="token operator">:</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span>
  assetsDir<span class="token operator">:</span> <span class="token string">&quot;static&quot;</span><span class="token punctuation">,</span>
  filenameHashing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    disableHostCheck<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    port<span class="token punctuation">,</span>
    overlay<span class="token operator">:</span> <span class="token punctuation">{</span>
      warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      errors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 自定义webpack配置</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
      alias<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;@&quot;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 把子应用打包成 umd 库格式</span>
      library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>
      jsonpFunction<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="react-配置示例"><a href="#react-配置示例" class="header-anchor">#</a> React 配置示例</h3> <p><strong>入口配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./index.scss&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reportWebVitals <span class="token keyword">from</span> <span class="token string">&quot;./reportWebVitals&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./public-path&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./utils/flexible&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// If you want to start measuring performance in your app, pass a function</span>
<span class="token comment">// to log results (for example: reportWebVitals(console.log))</span>
<span class="token comment">// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals</span>
<span class="token function">reportWebVitals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[react17] react app bootstraped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//     &lt;/React.StrictMode&gt;,</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>
    container
      <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_FREELOG__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>create react app 创建项目的配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code> <span class="token operator">**</span>通过npm run eject<span class="token punctuation">,</span> 释放出webpack配置<span class="token operator">**</span>

  <span class="token operator">**</span><span class="token operator">*</span>webpack 配置<span class="token operator">**</span><span class="token operator">*</span>
  <span class="token comment">/**
    *
    * 修改webpack.config.js
    * output处添加三个属性，name为package.json的name
    */</span>
      library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
      jsonpFunction<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token comment">/**
    * 修改webpackDevServer.config.js
    * 添加跨域headers
    */</span>
    port<span class="token operator">:</span> <span class="token string">'7102'</span><span class="token punctuation">,</span> <span class="token comment">// 端口自行定</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token operator">**</span><span class="token operator">*</span>热更新配置<span class="token operator">**</span><span class="token operator">*</span>
  <span class="token comment">/**
    * 修改env.js
    * 添加websocket所需的
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">WDS_SOCKET_HOST</span> <span class="token operator">=</span> <span class="token string">'localhost'</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">WDS_SOCKET_PATH</span> <span class="token operator">=</span> <span class="token string">'localhost:7102'</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">WDS_SOCKET_PORT</span> <span class="token operator">=</span> <span class="token string">'7102'</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="jquery-配置"><a href="#jquery-配置" class="header-anchor">#</a> jquery 配置</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// entry.js  在index.html中引入</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span>$<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#purehtml-container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, render with jQuery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token punctuation">(</span>global<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  global<span class="token punctuation">[</span><span class="token string">&quot;purehtml&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">bootstrap</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;purehtml bootstrap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">mount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;purehtml mount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">render</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">unmount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;purehtml unmount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="路由支持"><a href="#路由支持" class="header-anchor">#</a> 路由支持</h3> <p><strong>仅支持history路由或不由运行时管的abstract路由，hash路由还有问题需要改进</strong></p> <h3 id="配置总结"><a href="#配置总结" class="header-anchor">#</a> 配置总结</h3> <p><strong>由于运行时是通过 index.html 解析获取 js，css 文件，再进行运行插件的</strong></p> <p><strong>所以:</strong></p> <p><strong>1.让运行时具备动态修改的</strong><em>webpack_public_path</em><strong>的能力</strong></p> <p><strong>2.将 js 打包成库，让运行时能够获取到 bootstrap,mount,unmount 来启动卸载插件</strong></p> <h2 id="开发"><a href="#开发" class="header-anchor">#</a> 开发</h2> <h3 id="创建一个节点和主题"><a href="#创建一个节点和主题" class="header-anchor">#</a> 创建一个节点和主题</h3> <p>进入 console.testfreelog.com ---&gt; 节点管理</p> <p>创建节点后必须建一个主题资源并签约激活</p> <p>假设节点为http://snnaenu.testfreelog.com/</p> <p>用于开发的测试节点为http://t.snnaenu.testfreelog.com/</p> <h3 id="连接节点与插件"><a href="#连接节点与插件" class="header-anchor">#</a> 连接节点与插件</h3> <p>启动插件，例如‘http://localhost:7101’</p> <p>在节点 url 的http://t.snnaenu.testfreelog.com/后面加上</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token string">&quot;http://t.snnaenu.testfreelog.com/?dev=http:localhost:7101&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>此时插件是作为节点主题（即入口）使用</p> <p>替换指定子插件</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://t.snnaenu.testfreelog.com/?dev=replace&amp;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>widgetId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=http:localhost:7101</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h3 id="加载子依赖插件"><a href="#加载子依赖插件" class="header-anchor">#</a> 加载子依赖插件</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> subData <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getSubDep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
subData<span class="token punctuation">.</span>subDeps<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sub<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">mountWidget</span><span class="token punctuation">(</span>
    sub<span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;freelog-single&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    subData<span class="token punctuation">,</span>
    config<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 子插件配置数据，需要另外获取资源上的配置数据（待提供方法）</span>
    seq<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// 如果要用多个同样的子插件需要传递序号，可以考虑与其余节点插件避免相同的序号</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="加载孙插件-完善中"><a href="#加载孙插件-完善中" class="header-anchor">#</a> 加载孙插件（完善中）</h3> <h3 id="加载展品插件"><a href="#加载展品插件" class="header-anchor">#</a> 加载展品插件</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getPresentables</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resourceType<span class="token operator">:</span> <span class="token string">&quot;widget&quot;</span><span class="token punctuation">,</span>
  isLoadVersionProperty<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token keyword">const</span> widgets <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataList<span class="token punctuation">;</span>
widgets<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>widget<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">mountWidget</span><span class="token punctuation">(</span>
    widget<span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;freelog-single&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取插件自身配置数据"><a href="#获取插件自身配置数据" class="header-anchor">#</a> 获取插件自身配置数据</h2> <div class="language-ts extra-class"><pre class="language-ts"><code>
 <span class="token keyword">const</span> widgetConfig <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getSelfConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

</code></pre></div><h3 id="获取展品"><a href="#获取展品" class="header-anchor">#</a> 获取展品</h3> <p><strong>分页列表</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code>   <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getPresentablesPaging</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
   query<span class="token operator">:</span><span class="token punctuation">{</span>
    skip<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 从第几个开始</span>
    limit<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 取多少个</span>
    resourceType<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源类型</span>
    omitResourceType<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 过滤资源类型</span>
    tags<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 展品和资源标签，多个使用&quot;,&quot;隔开</span>
    projection<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
    keywords<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
    isLoadVersionProperty<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 是否加载版本</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><strong>查找展品</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getPresentablesSearch</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

 <span class="token punctuation">}</span><span class="token punctuation">)</span>
  query<span class="token operator">:</span><span class="token punctuation">{</span>
    presentableIds<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 展品ids 多个使用&quot;,&quot;隔开</span>
    resourceIds<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源ids</span>
    resourceNames<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源名称s</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="获取展品详情"><a href="#获取展品详情" class="header-anchor">#</a> 获取展品详情</h3> <div class="language-ts extra-class"><pre class="language-ts"><code> <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span>  window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getPresentableDetailById</span><span class="token punctuation">(</span>presentableId<span class="token punctuation">,</span> query<span class="token punctuation">)</span> 

 <span class="token operator">**</span>参数说明<span class="token operator">**</span>
  presentableId<span class="token operator">:</span> 展品id，
  query<span class="token operator">:</span><span class="token punctuation">{</span>
      projection<span class="token operator">:</span>  <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 需要指定哪些字段</span>
      isLoadVersionProperty<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 是否需要展品版本属性</span>
      isLoadCustomPropertyDescriptors<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 是否加载自定义属性信息</span>
      isLoadResourceDetailInfo<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 是否加载资源详细信息(额外查询了资源的封面,标签,简介等)</span>
      isLoadResourceVersionInfo<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 	是否加载资源版本信息(额外查询了资源版本的描述,创建日期,更新日期等)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="获取展品资源"><a href="#获取展品资源" class="header-anchor">#</a> 获取展品资源</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getFileStreamById</span><span class="token punctuation">(</span>
    presentableId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>  <span class="token comment">// 展品id</span>
    returnUrl<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token comment">// 是否只返回url， 例如img标签图片只需要url</span>
    config<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token comment">// axios的config 目前仅支持&quot;onUploadProgress&quot;, &quot;onDownloadProgress&quot;, &quot;responseType&quot;</span>
  <span class="token punctuation">)</span>
</code></pre></div><h3 id="获取展品子依赖"><a href="#获取展品子依赖" class="header-anchor">#</a> 获取展品子依赖</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span>  window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getSubFileStreamById</span><span class="token punctuation">(</span>
    presentableId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    parentNid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    subResourceIdOrName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    returnUrl<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token comment">// 是否只返回url， 例如img标签图片只需要url</span>
    config<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token comment">// axios的config 目前仅支持&quot;onUploadProgress&quot;, &quot;onDownloadProgress&quot;, &quot;responseType&quot;</span>
  <span class="token punctuation">)</span>
</code></pre></div><h3 id="授权处理"><a href="#授权处理" class="header-anchor">#</a> 授权处理</h3> <p><strong>单个呼出授权</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 根据展品id获取展品资源</span>
<span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getFileStreamById</span><span class="token punctuation">(</span>
  chapters<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>presentableId
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 *  未授权返回值
 * {
 *   data: {
 *     errCode: 3,
 *     presentableName,
 *     presentableId,
 *     errorMsg: response.data.data.errorMsg,
 *   },
 * }
 */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 提交给运行时处理</span>
  <span class="token comment">/**
   * addAuth 参数
   * {
   *  presentableId: string,
      resolve: Function,  // 授权成功回调
      reject: Function,  // 授权失败回调
      options?: {
        immediate: boolean  // 是否立即弹出授权窗口
      }
   * }
  */</span>
  ch <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> rej<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">addAuth</span><span class="token punctuation">(</span>
      ch<span class="token punctuation">.</span>data<span class="token punctuation">.</span>presentableId<span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getFileStreamById</span><span class="token punctuation">(</span>
          chapters<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>presentableId
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> immediate<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>呼出授权</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 当addAuth多个未授权展品且没有立刻呼出（或者存在未授权展品且已经addAuth 但用户关闭了，插件想要用户签约时）可以通过callAuth()唤出</span>
window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">callAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="静态文件处理"><a href="#静态文件处理" class="header-anchor">#</a> 静态文件处理</h3> <p><strong>打包之后 css 中的字体文件和图片加载 404</strong></p> <p>原因是 freelog 将外链样式改成了内联样式，但是字体文件和背景图片的加载路径是相对路径。</p> <p>而 css 文件一旦打包完成，就无法通过动态修改 publicPath 来修正其中的字体文件和背景图片的路径。</p> <p>解决方案：</p> <ol><li><p>大图片与大字体处理方式：</p> <p>大图片：放在不需要 webpack 打包的 public 目录下，通过 <strong>window.freelogApp.getStaticPath(path)</strong> 获取正确地址，
其中 path 为以/开头的正常开发时的路径。</p> <p>大字体：（暂未实现）如果路径写在 css 中则无需刻意放在 public 目录下，如果使用 js 去赋值，则同图片一样处理。</p></li> <li><p>小文件处理方式：借助 webpack 的 url-loader 将字体文件和图片打包成 base64（适用于字体文件和图片体积小的项目）</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|webp|woff2?|eot|ttf|otf)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>vue-cli3 项目写法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&quot;fonts&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>5. vue-cli3 项目可以将 css 打包到 js 里面，不单独生成文件(不推荐，仅适用于 css 较少的项目)</strong></p> <p>配置参考 <a href="https://cli.vuejs.org/zh/config/#css-extract" target="_blank" rel="noopener noreferrer">vue-cli3 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  css<span class="token operator">:</span> <span class="token punctuation">{</span>
    extract<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="重载插件"><a href="#重载插件" class="header-anchor">#</a> 重载插件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 目前重载后挂载在window的数据没变，后期增加参数可选是否保留，以及返回重载失败可由插件决定是否刷新页面、同时需要主题授权</span>
window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="插件通信"><a href="#插件通信" class="header-anchor">#</a> 插件通信</h3> <p><strong>完善中</strong></p> <h3 id="获取当前登录用户信息"><a href="#获取当前登录用户信息" class="header-anchor">#</a> 获取当前登录用户信息</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="监听用户登录事件"><a href="#监听用户登录事件" class="header-anchor">#</a> 监听用户登录事件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// callback: 登录成功的回调，登录失败不会回调</span>
window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">onLogin</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="用户数据"><a href="#用户数据" class="header-anchor">#</a> 用户数据</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 开发者模式需要注意在入口文件加载页面加上主题或插件本身的资源名称,例如：</span>
window<span class="token punctuation">.</span><span class="token constant">FREELOG_RESOURCENAME</span> <span class="token operator">=</span> Freelog<span class="token operator">/</span>dev<span class="token operator">-</span>docs

<span class="token comment">// 更新用户数据   data 为任意对象，</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">setUserData</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取用户数据</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="打包上传"><a href="#打包上传" class="header-anchor">#</a> 打包上传</h2> <p><strong>正常 build 后，将打包后的所有文件压缩为一个 zip 文件（无根目录），作为主题 theme 或插件 widget 类型上传为资源</strong></p> <h2 id="移动端适配"><a href="#移动端适配" class="header-anchor">#</a> 移动端适配</h2> <p><strong>目前仅支持最新的问题最少的最好的viewport兼容方案</strong></p> <p><strong>推荐使用 postcss-px-to-viewport 插件, 各框架具体使用方法请百度</strong></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/freelog-runtime/assets/js/app.97b599e4.js" defer></script><script src="/freelog-runtime/assets/js/2.b24e057d.js" defer></script><script src="/freelog-runtime/assets/js/7.03a5609f.js" defer></script>
  </body>
</html>
