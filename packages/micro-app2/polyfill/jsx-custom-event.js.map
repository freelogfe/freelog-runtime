{"version":3,"file":"jsx-custom-event.js","sources":["../src/polyfill/jsx-custom-event.ts"],"sourcesContent":["const React = require('react')\r\n\r\ntype MicroElementType = HTMLElement & Record<string, unknown>\r\n\r\n// lifecycles\r\nconst eventLifeCycles = [\r\n  'oncreated',\r\n  'onbeforemount',\r\n  'onmounted',\r\n  'onunmount',\r\n  'onerror',\r\n  'ondatachange',\r\n  'onbeforeshow',\r\n  'onaftershow',\r\n  'onafterhidden',\r\n]\r\n\r\nfunction jsxCustomEvent (\r\n  type: string | CallableFunction,\r\n  props: Record<string, unknown> | null,\r\n  ...children: any[]\r\n): void {\r\n  if (typeof type !== 'string' || !/^micro-app(-\\S+)?/.test(type) || !props) {\r\n    return React.createElement.apply(null, [type, props, ...children])\r\n  }\r\n\r\n  const newProps = Object.assign({}, props)\r\n\r\n  // ref will call when create, update, unmount\r\n  newProps.ref = (element: MicroElementType | null) => {\r\n    if (typeof props.ref === 'function') {\r\n      props.ref(element)\r\n    } else if (typeof props.ref === 'object') {\r\n      (props.ref as any).current = element\r\n    }\r\n\r\n    // when unmount and update the element is null\r\n    if (element) {\r\n      // Update data when the prev and next data are different\r\n      if (toString.call(props.data) === '[object Object]' && element.data !== props.data) {\r\n        element.data = props.data\r\n      }\r\n\r\n      for (const key in props) {\r\n        if (\r\n          Object.prototype.hasOwnProperty.call(props, key) &&\r\n          eventLifeCycles.includes(key.toLowerCase()) &&\r\n          typeof props[key] === 'function' &&\r\n          (!element[key] || element[key] !== props[key])\r\n        ) {\r\n          const eventName = key.toLowerCase().replace('on', '')\r\n          if (element[key]) {\r\n            // @ts-ignore\r\n            element.removeEventListener(eventName, element[key], false)\r\n          }\r\n          // @ts-ignore\r\n          element.addEventListener(eventName, props[key], false)\r\n          element[key] = props[key]\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return React.createElement.apply(null, [type, newProps, ...children])\r\n}\r\n\r\nmodule.exports = jsxCustomEvent\r\nmodule.exports.default = jsxCustomEvent\r\n"],"names":[],"mappings":"AAAA,MAAM,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAA;AAI9B;AACA,MAAM,eAAe,GAAG;IACtB,WAAW;IACX,eAAe;IACf,WAAW;IACX,WAAW;IACX,SAAS;IACT,cAAc;IACd,cAAc;IACd,aAAa;IACb,eAAe;CAChB,CAAA;AAED,SAAS,cAAc,CACrB,IAA+B,EAC/B,KAAqC,EACrC,GAAG,QAAe;IAElB,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;QACzE,OAAO,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,KAAK,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAA;KACnE;IAED,MAAM,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,CAAA;;IAGzC,QAAQ,CAAC,GAAG,GAAG,CAAC,OAAgC;QAC9C,IAAI,OAAO,KAAK,CAAC,GAAG,KAAK,UAAU,EAAE;YACnC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;SACnB;aAAM,IAAI,OAAO,KAAK,CAAC,GAAG,KAAK,QAAQ,EAAE;YACvC,KAAK,CAAC,GAAW,CAAC,OAAO,GAAG,OAAO,CAAA;SACrC;;QAGD,IAAI,OAAO,EAAE;;YAEX,IAAI,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,iBAAiB,IAAI,OAAO,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,EAAE;gBAClF,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAA;aAC1B;YAED,KAAK,MAAM,GAAG,IAAI,KAAK,EAAE;gBACvB,IACE,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC;oBAChD,eAAe,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;oBAC3C,OAAO,KAAK,CAAC,GAAG,CAAC,KAAK,UAAU;qBAC/B,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,EAC9C;oBACA,MAAM,SAAS,GAAG,GAAG,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAA;oBACrD,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE;;wBAEhB,OAAO,CAAC,mBAAmB,CAAC,SAAS,EAAE,OAAO,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,CAAA;qBAC5D;;oBAED,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,CAAA;oBACtD,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,CAAA;iBAC1B;aACF;SACF;KACF,CAAA;IAED,OAAO,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,QAAQ,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAA;AACvE,CAAC;AAED,MAAM,CAAC,OAAO,GAAG,cAAc,CAAA;AAC/B,MAAM,CAAC,OAAO,CAAC,OAAO,GAAG,cAAc"}